# Kontinuasjonseksamensoppgave PGR301 - tilpasset hjemmeeksamen 72 timer. 


## Fra Læreplan

Egenutviklet applikasjon (eller prototype) med tilhørende dokumentasjon: teller 100% av karakteren i emnet. Applikasjonen skal være utviklet, og være vedlikeholdbar, i et DevOps- miljø i skyen. Kildekode, og annen dokumentasjon, skal gjøres tilgjengelig for allmenheten."

Siden et kontinuerlig kjørende DevOps-miljø kan være kostnadsbærende for studentene vil vi lette på kravet om miljøet skal kjøre kontinuerlig i skyen. Applikasjonen må istedet være mulig å etablere i skyen ved hjelp av infrastruktur som kode (Terraform) - og enkel automatisering.

På den måten kan de som måtte ønske å ta løsningen i bruk ( for eksempel eksaminator ) bruke egen infrastruktur (og da ta kostnaden for drift av miljøet)

## Krav

* Applikasjonen og tilhørende DevOps infrastruktur skal gjøres tilgjenglig i offentlige GitHub repositories.
* Leveransen må være annonym 
* Du skal levere et dokument (tekstfil) i wiseflow som lenker til relevante repositories i GitHub 
* Infra-repository skal inneholde en credentials_example.yml som eksemplifiserer nødvendige hemmeligheter som er nødvendig for pipeline (github_tokens, deploy keys, api keys til diverse tjenester osv).
* Det skal lages ett infrastruktur repository og ett kode-repository for applikasjonen.

Følgende to repositories *kan* brukes som startpunkt. Dette er ikke et krav. 

- https://github.com/PGR301-2018/exam-infra
- https://github.com/PGR301-2018/exam-app

Applikasjonen må være innholdsrik nok demonstrere DevOps-prinisipper og bevise ferdigheter hos studenten. Det anbefales ikke å kun gjøre enkle modifikasjoner på eksempel-appen, men istedet finne et eksempel fra hobby/interesse/ eller et annet prosjekt man har gjort i et annet fag. 

* Applikasjonen skal bestå av både av et API og en database. Minimalt et REST API med CRUD kapabilitet.   
* Databasen kan være "in Memory" (h2 osv) 
* Applikasjonen skal bygge med Maven
* Applikasjonen skal ha enhetstester

## Oppgaver

# Basis pipeline (10 poeng)

* Innleveringen skal tilfredstille krav nevnt over under "Krav til leveranse". 
* I tillegg skal det lages en Concourse CI/CD Pipeline som bygger applikasjonen og kjører tester hver gang det skjer en commit til master branch.
* Master branch skal være beskyttet mot commits som ikke skjer via Pull requests. (Protected master branch)

# Docker/Container deployment av applikasjonen (10 poeng)

* Det skal skrives en Dockerfil bygger et Container Image av Spring Boot applikasjonen.
* Eksaminator vil teste applikasjonen ved å gjøre en ```docker build ...``` og 
* I denne oppgaven vektlegges DevOps


# Metrics (10 poeng)

Applikasjonen skal logge egendefinerte metrics. Med det menes at man på valgte steder i koden skal logge datapunkter. Evalueringen blir gjort basert på om Metrics er korrekt implementert på
en fornuftig måte i applikasjonen.

Til dette skal applikasjonen bruke [Metrics bibliotektet fra Dropwizard](https://metrics.dropwizard.io/4.0.0/getting-started.html) å integrere dette i Spring boot applikasjonen ;

Med DropWizard man man for eksempel bruke en "Meter" klasse for å telle antall forekomster av en hendelse.
I evalueringen vektlegges det at man utvider Applikasjonen nok til å demonstrere  forskjellige typer metrics. Med det menes at applikasjonen må være innholdsrik nok til at det gir mening å bruke disse type metrikker. 

* Meter 
* Gauge 
* Counter 
* Histogram 
* Timer

Metrics skal IKKE leveres til en skytjeneste eller liknende. Oppgaven evaulueres på bakgrunn av hvordan de ulike metrikkene er implementert i applikasjonen.

Metrics skal sendes til stdout ved å inkludere følgende spring bean i prosjektet 

```java

@Configuration
public class ReporterConfig {

    @Bean
    public MetricRegistry getRegistry() {
        return new MetricRegistry();
    }

    @Bean
    public Reporter getReporter(MetricRegistry registry) {
        ConsoleReporter reporter = ConsoleReporter.forRegistry(getRegistry())
                .convertRatesTo(TimeUnit.SECONDS)
                .convertDurationsTo(TimeUnit.MILLISECONDS)
                .build();
        reporter.start(1, TimeUnit.SECONDS);
        return reporter;
    }
}```

# Applikasjonslogger (10 poeng)

Denne oppgaven består av å bruke en tjeneste for innsamling, visualisering og analyse av logger. Dere ska utvide applikasjonen på en slik måte at logger sendes til denne tjenesten.

I oppgaven skal dere registrere dere på- og bruke tjenesten [Logz.io](https://app.logz.io/) som er en SAAS løsning som tilbyr ELK (ElasticSearch, Logstash, Kibana) Stack der man kan lagre 3GB med lagring i en plan som er gratis.

På nettsidene til logz.io er det [instruksjoner dere kan følge for å sette opp logging i Java  applikasjoner](https://app.logz.io/#/dashboard/data-sources/Java--logbackappender). (Det lønner deg å være logget på hvis dere følger lenken.)

OBS. Dere må ikke bruke Logz.io som en Heroku-addon. Det koster penger.

Eksaminator vil se ut ifra konfigurasjon(logback.xml), og ut ifra applikasjonskode (Log statements) at oppgaven er løst. 

